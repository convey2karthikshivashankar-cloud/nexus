"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const dynamoClient = new client_dynamodb_1.DynamoDBClient({});
const docClient = lib_dynamodb_1.DynamoDBDocumentClient.from(dynamoClient);
const CONNECTIONS_TABLE = process.env.CONNECTIONS_TABLE;
const handler = async (event) => {
    const routeKey = event.requestContext.routeKey;
    const connectionId = event.requestContext.connectionId;
    console.log(`WebSocket ${routeKey} for connection ${connectionId}`);
    try {
        switch (routeKey) {
            case '$connect':
                await docClient.send(new lib_dynamodb_1.PutCommand({
                    TableName: CONNECTIONS_TABLE,
                    Item: {
                        connectionId,
                        connectedAt: new Date().toISOString(),
                    },
                }));
                return { statusCode: 200, body: 'Connected' };
            case '$disconnect':
                await docClient.send(new lib_dynamodb_1.DeleteCommand({
                    TableName: CONNECTIONS_TABLE,
                    Key: { connectionId },
                }));
                return { statusCode: 200, body: 'Disconnected' };
            default:
                return { statusCode: 200, body: 'OK' };
        }
    }
    catch (error) {
        console.error('WebSocket error:', error);
        return { statusCode: 500, body: 'Error: ' + error.message };
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw4REFBMEQ7QUFDMUQsd0RBQTBGO0FBSTFGLE1BQU0sWUFBWSxHQUFHLElBQUksZ0NBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM1QyxNQUFNLFNBQVMsR0FBRyxxQ0FBc0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFNUQsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFrQixDQUFDO0FBRWxELE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUEyQixFQUFrQyxFQUFFO0lBQzNGLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO0lBQy9DLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxjQUFjLENBQUMsWUFBYSxDQUFDO0lBRXhELE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxRQUFRLG1CQUFtQixZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBRXBFLElBQUksQ0FBQztRQUNILFFBQVEsUUFBUSxFQUFFLENBQUM7WUFDakIsS0FBSyxVQUFVO2dCQUNiLE1BQU0sU0FBUyxDQUFDLElBQUksQ0FDbEIsSUFBSSx5QkFBVSxDQUFDO29CQUNiLFNBQVMsRUFBRSxpQkFBaUI7b0JBQzVCLElBQUksRUFBRTt3QkFDSixZQUFZO3dCQUNaLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtxQkFDdEM7aUJBQ0YsQ0FBQyxDQUNILENBQUM7Z0JBQ0YsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDO1lBRWhELEtBQUssYUFBYTtnQkFDaEIsTUFBTSxTQUFTLENBQUMsSUFBSSxDQUNsQixJQUFJLDRCQUFhLENBQUM7b0JBQ2hCLFNBQVMsRUFBRSxpQkFBaUI7b0JBQzVCLEdBQUcsRUFBRSxFQUFFLFlBQVksRUFBRTtpQkFDdEIsQ0FBQyxDQUNILENBQUM7Z0JBQ0YsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDO1lBRW5EO2dCQUNFLE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMzQyxDQUFDO0lBQ0gsQ0FBQztJQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7UUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6QyxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBcENXLFFBQUEsT0FBTyxXQW9DbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEeW5hbW9EQkNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1keW5hbW9kYic7XHJcbmltcG9ydCB7IER5bmFtb0RCRG9jdW1lbnRDbGllbnQsIFB1dENvbW1hbmQsIERlbGV0ZUNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9saWItZHluYW1vZGInO1xyXG5pbXBvcnQgeyBBcGlHYXRld2F5TWFuYWdlbWVudEFwaUNsaWVudCwgUG9zdFRvQ29ubmVjdGlvbkNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtYXBpZ2F0ZXdheW1hbmFnZW1lbnRhcGknO1xyXG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCwgQVBJR2F0ZXdheVByb3h5UmVzdWx0IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcblxyXG5jb25zdCBkeW5hbW9DbGllbnQgPSBuZXcgRHluYW1vREJDbGllbnQoe30pO1xyXG5jb25zdCBkb2NDbGllbnQgPSBEeW5hbW9EQkRvY3VtZW50Q2xpZW50LmZyb20oZHluYW1vQ2xpZW50KTtcclxuXHJcbmNvbnN0IENPTk5FQ1RJT05TX1RBQkxFID0gcHJvY2Vzcy5lbnYuQ09OTkVDVElPTlNfVEFCTEUhO1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50KTogUHJvbWlzZTxBUElHYXRld2F5UHJveHlSZXN1bHQ+ID0+IHtcclxuICBjb25zdCByb3V0ZUtleSA9IGV2ZW50LnJlcXVlc3RDb250ZXh0LnJvdXRlS2V5O1xyXG4gIGNvbnN0IGNvbm5lY3Rpb25JZCA9IGV2ZW50LnJlcXVlc3RDb250ZXh0LmNvbm5lY3Rpb25JZCE7XHJcblxyXG4gIGNvbnNvbGUubG9nKGBXZWJTb2NrZXQgJHtyb3V0ZUtleX0gZm9yIGNvbm5lY3Rpb24gJHtjb25uZWN0aW9uSWR9YCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBzd2l0Y2ggKHJvdXRlS2V5KSB7XHJcbiAgICAgIGNhc2UgJyRjb25uZWN0JzpcclxuICAgICAgICBhd2FpdCBkb2NDbGllbnQuc2VuZChcclxuICAgICAgICAgIG5ldyBQdXRDb21tYW5kKHtcclxuICAgICAgICAgICAgVGFibGVOYW1lOiBDT05ORUNUSU9OU19UQUJMRSxcclxuICAgICAgICAgICAgSXRlbToge1xyXG4gICAgICAgICAgICAgIGNvbm5lY3Rpb25JZCxcclxuICAgICAgICAgICAgICBjb25uZWN0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogJ0Nvbm5lY3RlZCcgfTtcclxuXHJcbiAgICAgIGNhc2UgJyRkaXNjb25uZWN0JzpcclxuICAgICAgICBhd2FpdCBkb2NDbGllbnQuc2VuZChcclxuICAgICAgICAgIG5ldyBEZWxldGVDb21tYW5kKHtcclxuICAgICAgICAgICAgVGFibGVOYW1lOiBDT05ORUNUSU9OU19UQUJMRSxcclxuICAgICAgICAgICAgS2V5OiB7IGNvbm5lY3Rpb25JZCB9LFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogJ0Rpc2Nvbm5lY3RlZCcgfTtcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogMjAwLCBib2R5OiAnT0snIH07XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDUwMCwgYm9keTogJ0Vycm9yOiAnICsgZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufTtcclxuIl19